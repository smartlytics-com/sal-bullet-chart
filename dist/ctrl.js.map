{"version":3,"sources":["../src/ctrl.js"],"names":["d3","panelDefaults","fontSizes","fontTypes","colors","bullet","titleFontSize","subtitleFontSize","outerEdgeCol","innerCol","pivotCol","needleCol","unitsLabelCol","tickLabelCol","tickColMaj","tickColMin","tickFont","titleFont","subtitleFont","titleCol","subtitleCol","rangeCol","measureCol","markerCol","tickCol","rangesColor","measuresColor","D3BulletPanelCtrl","$scope","$injector","alertSrv","_","defaults","panel","bulletDivId","id","containerDivId","scoperef","alertSrvRef","initialized","panelContainer","svgContainer","svg","panelWidth","panelHeight","bulletObject","bulletsData","data","value","valueFormatted","valueRounded","series","events","on","onInitEditMode","bind","onDataReceived","onDataError","panels","grafanaBootData","settings","thisPanel","pluginId","thisPanelPath","baseUrl","optionsPath","addEditorTab","container","trueWidth","span","offsetParent","clientWidth","viewPortWidth","Math","max","document","documentElement","window","innerWidth","pixelsPerSpan","round","tmpPanelHeight","height","String","panelTitleOffset","title","containerHeight","row","replace","actualHeight","parseInt","length","remove","getPanelWidthBySpan","getPanelHeight","console","log","margin","top","right","bottom","left","width","rangeColChange","measureColChange","chart","options","select","selectAll","enter","append","attr","call","style","text","d","subtitle","datum","randomize","duration","randomizer","ranges","map","markers","measures","k","random","color","p","temp","result","slice","floor","toString","padStart","i","push","getRandomColor","render","scope","elem","attrs","ctrl","bulletByClass","find","childNodes","setContainer","renderBullet","renderingCompleted","isNumber","decimals","scaledDecimals","delta","dec","LN10","magn","pow","norm","size","err","serie","alias","stats","min","toFixed","range","avg","dataList","seriesHandler","parseSeries","updateBullet","seriesData","TimeSeries","datapoints","target","flotpairs","getFlotPairs","nullPointMode","MetricsPanelCtrl","templateUrl"],"mappings":"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","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport kbn from 'app/core/utils/kbn';\nimport config from 'app/core/config';\nimport TimeSeries from 'app/core/time_series2';\n//import * as d3 from '../bower_components/d3/d3.js';\nimport * as d3 from './external/d3.v3.min';\nimport './css/panel.css!';\nimport './external/d3bullet';\n\nconst panelDefaults = {\n  fontSizes: [4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70],\n  fontTypes: [\n    'Arial', 'Avant Garde', 'Bookman',\n    'Consolas', 'Courier', 'Courier New',\n    'Garamond', 'Helvetica', 'Open Sans',\n    'Palatino', 'Times', 'Times New Roman',\n    'Verdana'\n  ],\n  colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n  bullet: {\n    titleFontSize: 22,\n    subtitleFontSize: 18,\n    outerEdgeCol:  '#0099CC',\n    innerCol:      '#fff',\n    pivotCol:      '#999',\n    needleCol:     '#0099CC',\n    unitsLabelCol: '#000',\n    tickLabelCol:  '#000',\n    tickColMaj:    '#0099CC',\n    tickColMin:    '#000',\n    tickFont: 'Open Sans',\n    titleFont: 'Open Sans',\n    subtitleFont: 'Open Sans',\n    titleCol: '#fff',\n    subtitleCol: '#999',\n    rangeCol: '#0099CC',\n    measureCol:'#7eb26d',\n    markerCol: '#000',\n    tickCol: '#FFF',\n    rangesColor: [],\n    measuresColor : [],\n  },\n};\n\nclass D3BulletPanelCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, alertSrv) {\n    super($scope, $injector);\n    // merge existing settings with our defaults\n    _.defaults(this.panel, panelDefaults);\n    this.panel.bulletDivId = 'd3bullet_svg_' + this.panel.id;\n    this.containerDivId = 'container_'+this.panel.bulletDivId;\n    this.scoperef = $scope;\n    this.alertSrvRef = alertSrv;\n    this.initialized = false;\n    this.panelContainer = null;\n    this.panel.svgContainer = null;\n    this.svg = null;\n    this.panelWidth = null;\n    this.panelHeight = null;\n    this.bulletObject = null;\n    this.bulletsData =[];\n    this.data = {\n      value: 0,\n      valueFormatted: 0,\n      valueRounded: 0\n    };\n    this.series = [];\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    //this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n  }\n\n  onInitEditMode() {\n    // determine the path to this plugin\n    var panels = grafanaBootData.settings.panels;\n    var thisPanel = panels[this.pluginId];\n    var thisPanelPath = thisPanel.baseUrl + '/';\n    //add the relative path to the partial\n    var optionsPath = thisPanelPath + 'partials/editor.options.html';\n    this.addEditorTab('Options', optionsPath, 2);\n    // var radialMetricsPath = thisPanelPath + 'partials/editor.radialmetrics.html';\n    // this.addEditorTab('Radial Metrics', radialMetricsPath, 3);\n    // var thresholdingPath = thisPanelPath + 'partials/editor.thresholding.html';\n    // this.addEditorTab('Thresholding', thresholdingPath, 4);\n    // var mappingsPath = thisPanelPath + 'partials/editor.mappings.html';\n    // this.addEditorTab('Value Mappings', mappingsPath, 5);\n  }\n\n  /**\n   * [setContainer description]\n   * @param {[type]} container [description]\n   */\n  setContainer(container) {\n    this.panelContainer = container;\n    this.panel.svgContainer = container;\n  }\n\n  // determine the width of a panel by the span and viewport\n  getPanelWidthBySpan() {\n    var trueWidth = 0;\n    if (typeof this.panel.span === 'undefined') {\n      // get the width based on the scaled container (v5 needs this)\n      trueWidth = this.panelContainer.offsetParent.clientWidth;\n    } else {\n      // v4 and previous used fixed spans\n      var viewPortWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n      // get the pixels of a span\n      var pixelsPerSpan = viewPortWidth / 12;\n      // multiply num spans by pixelsPerSpan\n      trueWidth = Math.round(this.panel.span * pixelsPerSpan);\n    }\n    return trueWidth;\n  }\n\n  getPanelHeight() {\n    // panel can have a fixed height set via \"General\" tab in panel editor\n    var tmpPanelHeight = this.panel.height;\n    if ((typeof tmpPanelHeight === 'undefined') || (tmpPanelHeight === \"\")) {\n      // grafana also supplies the height, try to use that if the panel does not have a height\n      tmpPanelHeight = String(this.height);\n      // v4 and earlier define this height, detect span for pre-v5\n      if (typeof this.panel.span != 'undefined') {\n        // if there is no header, adjust height to use all space available\n        var panelTitleOffset = 20;\n        if (this.panel.title !== \"\") {\n          panelTitleOffset = 42;\n        }\n        tmpPanelHeight = String(this.containerHeight - panelTitleOffset); // offset for header\n      }\n      if (typeof tmpPanelHeight === 'undefined') {\n        // height still cannot be determined, get it from the row instead\n        tmpPanelHeight = this.row.height;\n        if (typeof tmpPanelHeight === 'undefined') {\n          // last resort - default to 250px (this should never happen)\n          tmpPanelHeight = \"250\";\n        }\n      }\n    }\n    // replace px\n    tmpPanelHeight = tmpPanelHeight.replace(\"px\",\"\");\n    // convert to numeric value\n    var actualHeight = parseInt(tmpPanelHeight);\n    return actualHeight;\n  }\n\n  clearSVG() {\n    if ($('#'+this.panel.bulletDivId).length) {\n      //console.log(\"Clearing SVG id: \" + this.panel.bulletDivId);\n      $('#'+this.panel.bulletDivId).remove();\n    }\n  }\n\n  renderBullet() {\n    // update the values to be sent to the bullet constructor\n    if ($('#'+this.panel.bulletDivId).length) {\n      $('#'+this.panel.bulletDivId).remove();\n    }\n    $('.bullet').remove();\n    this.panelWidth = this.getPanelWidthBySpan();\n    this.panelHeight = this.getPanelHeight();\n    console.log(this.panelWidth);\n    console.log(this.panelHeight);\n    var data = this.bulletsData;\n    var margin = {top: 10, right: 40, bottom: 40, left: 120};\n    var width = this.panelWidth - margin.left - margin.right;\n    var height = this.panelHeight/data.length - margin.top - margin.bottom;\n    // set the width and height to be double the radius\n\n    if(this.panel.bullet.rangesColor.length === 0){\n      this.rangeColChange();\n    }\n    if(this.panel.bullet.measuresColor.length === 0){\n      this.measureColChange();\n    }\n    var chart = d3.bullet()\n      .width(width)\n      .height(height)\n      .options(this.panel.bullet);\n\n    this.svg = d3.select(\"#\" + this.containerDivId).selectAll(\"svg\")\n        .data(data)\n      .enter().append(\"svg\")\n        .attr(\"class\", \"bullet\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n      .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n        .call(chart);\n\n    var title = this.svg.append(\"g\")\n        .style(\"text-anchor\", \"end\")\n        .attr(\"transform\", \"translate(-6,\" + height / 2 + \")\");\n\n    title.append(\"text\")\n        .attr(\"class\", \"title\")\n        .attr(\"font-family\", this.panel.bullet.titleFont)\n        .attr(\"font-size\", this.panel.bullet.titleFontSize + \"px\")\n        .attr(\"fill\", this.panel.bullet.titleCol)\n        .text(function(d) { return d.title; });\n\n    title.append(\"text\")\n        .attr(\"class\", \"subtitle\")\n        .attr(\"font-family\", this.panel.bullet.subtitleFont)\n        .attr(\"font-size\", this.panel.bullet.subtitleFontSize + \"px\")\n        .attr(\"fill\", this.panel.bullet.subtitleCol)\n        .attr(\"dy\", \"1em\")\n        .text(function(d) { return d.subtitle; });\n\n    d3.selectAll(\"button\").on(\"click\", function() {\n      this.svg.datum(randomize).call(chart.duration(1000)); // TODO automatic transition\n    });\n  }\n  randomize(d) {\n    if (!d.randomizer) d.randomizer = randomizer(d);\n    d.ranges = d.ranges.map(d.randomizer);\n    d.markers = d.markers.map(d.randomizer);\n    d.measures = d.measures.map(d.randomizer);\n    return d;\n  }\n\n  randomizer(d) {\n    var k = d3.max(d.ranges) * 0.2;\n    return function(d) {\n      return Math.max(0, d + k * (Math.random() - 0.5));\n    };\n  }\n\n  getRandomColor(color) {\n    var p = 1,temp,random = Math.random(),result = '#';\n    while (p < color.length) {\n      temp = parseInt(color.slice(p, p += 2), 16);\n      temp += Math.floor((255 - temp) * random);\n      result += temp.toString(16).padStart(2, '0');\n    }\n    return result;\n  }\n\n  rangeColChange(){\n    var rangesColor = [];\n    var color = this.panel.bullet.rangeCol;\n    for (var i = 0; i < 30; i++) {\n      rangesColor.push(this.getRandomColor(color));\n    }\n    if(this.panel.bullet.rangesColor.length > 0){\n      this.panel.bullet.rangesColor = rangesColor;\n      this.render();\n    }\n    else{\n      this.panel.bullet.rangesColor = rangesColor;\n    }\n  }\n\n  measureColChange(){\n    var color = this.panel.bullet.measureCol;\n    var measuresColor = [];\n    for (var i = 0; i < 30; i++) {\n      measuresColor.push(this.getRandomColor(color));\n    }\n    if(this.panel.bullet.measuresColor.length > 0){\n      this.panel.bullet.measuresColor = measuresColor;\n      this.render();\n    }\n    else{\n      this.panel.bullet.measuresColor = measuresColor;\n    }\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    //console.log(\"d3bullet inside link\");\n    var bulletByClass = elem.find('.grafana-d3-bullet');\n    //bulletByClass.append('<center><div id=\"'+ctrl.containerDivId+'\"></div></center>');\n    bulletByClass.append('<div id=\"'+ctrl.containerDivId+'\"></div>');\n    var container = bulletByClass[0].childNodes[0];\n    ctrl.setContainer(container);\n    function render() {\n      ctrl.renderBullet();\n    }\n    this.events.on('render', function() {\n      render();\n      ctrl.renderingCompleted();\n    });\n  }\n\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return {decimals: this.panel.decimals, scaledDecimals: null};\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n        norm = delta / magn, // norm is between 1.0 and 10.0\n        size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) { dec = 0; }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n    return result;\n  }\n\n  onDataError(err) {\n    this.onDataReceived([]);\n  }\n  parseSeries(series) {\n    return _.map(this.series, (serie, i) => {\n      return {\n        title: serie.alias,\n        subtitle:serie.alias,\n        ranges: [parseInt(serie.stats.min.toFixed(2)), parseInt(serie.stats.max.toFixed(2))- parseInt(serie.stats.range.toFixed(2))/2 ,parseInt(serie.stats.max.toFixed(2))],\n        measures:[parseInt(serie.stats.min.toFixed(2)) + parseInt(serie.stats.range.toFixed(2))/3, parseInt(serie.stats.min.toFixed(2)) + parseInt(serie.stats.range.toFixed(2))/3*2],\n        markers:[parseInt(serie.stats.avg.toFixed(2))]\n      };\n    });\n  }\n  onDataReceived(dataList) {\n    this.series = dataList.map(this.seriesHandler.bind(this));\n    var data = {};\n    this.bulletsData = this.parseSeries(this.series);\n    if(this.bulletObject !== null){\n      this.bulletObject.updateBullet(data.value, data.valueFormatted, data.valueRounded);\n    } else {\n      // render bullet\n      this.render();\n    }\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n}\n\nD3BulletPanelCtrl.templateUrl = 'partials/template.html';\nexport {\n  D3BulletPanelCtrl,\n  D3BulletPanelCtrl as MetricsPanelCtrl\n};\n"]}