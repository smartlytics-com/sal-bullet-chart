{"version":3,"sources":["../src/ctrl.js"],"names":["d3","panelDefaults","fontSizes","fontTypes","unitFormats","kbn","getUnitFormats","operatorNameOptions","valueMaps","value","op","text","mappingTypes","name","rangeMaps","from","to","tickMaps","mappingType","thresholds","colors","decimals","format","operatorName","bullet","minValue","maxValue","tickSpaceMinVal","tickSpaceMajVal","bulletUnits","bulletRadius","pivotRadius","padding","edgeWidth","tickEdgeGap","tickLengthMaj","tickLengthMin","needleTickGap","needleLengthNeg","ticknessBulletBasis","needleWidth","tickWidthMaj","tickWidthMin","titleFontSize","subtitleFontSize","zeroTickAngle","maxTickAngle","zeroNeedleAngle","maxNeedleAngle","outerEdgeCol","innerCol","pivotCol","needleCol","unitsLabelCol","tickLabelCol","tickColMaj","tickColMin","tickFont","titleFont","subtitleFont","titleCol","subtitleCol","rangeCol","measureCol","markerCol","tickCol","rangesColor","measuresColor","valueYOffset","showThresholdOnBullet","showThresholdColorOnValue","showLowerThresholdRange","showMiddleThresholdRange","showUpperThresholdRange","animateNeedleValueTransition","animateNeedleValueTransitionSpeed","D3BulletPanelCtrl","$scope","$injector","alertSrv","_","defaults","panel","bulletDivId","id","containerDivId","scoperef","alertSrvRef","initialized","panelContainer","svgContainer","svg","panelWidth","panelHeight","bulletObject","bulletsData","data","valueFormatted","valueRounded","series","events","on","onInitEditMode","bind","onDataReceived","onDataError","panels","grafanaBootData","settings","thisPanel","pluginId","thisPanelPath","baseUrl","optionsPath","addEditorTab","container","trueWidth","span","offsetParent","clientWidth","viewPortWidth","Math","max","document","documentElement","window","innerWidth","pixelsPerSpan","round","tmpPanelHeight","height","String","panelTitleOffset","title","containerHeight","row","replace","actualHeight","parseInt","length","remove","setValues","getPanelWidthBySpan","getPanelHeight","console","log","margin","top","right","bottom","left","width","rangeColChange","measureColChange","chart","options","select","selectAll","enter","append","attr","call","style","d","subtitle","datum","randomize","duration","randomizer","ranges","map","markers","measures","k","random","color","p","temp","result","slice","floor","toString","padStart","i","push","getRandomColor","render","index","indexOf","splice","rangeMap","tickMap","set","isNaN","bulletTickDegrees","bulletNeedleDegrees","scope","elem","attrs","ctrl","bulletByClass","find","childNodes","setContainer","renderBullet","renderingCompleted","isNumber","scaledDecimals","delta","dec","LN10","magn","pow","norm","size","columns","rows","j","JSON","parse","bullets","subItem","err","serie","alias","stats","min","toFixed","range","avg","dataList","seriesHandler","parseSeries","updateBullet","seriesData","TimeSeries","datapoints","target","flotpairs","getFlotPairs","nullPointMode","tmp","MetricsPanelCtrl","getColorForValue","colorMap","first","templateUrl"],"mappings":"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","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport kbn from 'app/core/utils/kbn';\nimport config from 'app/core/config';\nimport TimeSeries from 'app/core/time_series2';\n//import * as d3 from '../bower_components/d3/d3.js';\nimport * as d3 from './external/d3.v3.min';\nimport './css/panel.css!';\nimport './external/d3bullet';\n\nconst panelDefaults = {\n  fontSizes: [4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70],\n  fontTypes: [\n    'Arial', 'Avant Garde', 'Bookman',\n    'Consolas', 'Courier', 'Courier New',\n    'Garamond', 'Helvetica', 'Open Sans',\n    'Palatino', 'Times', 'Times New Roman',\n    'Verdana'\n  ],\n  unitFormats: kbn.getUnitFormats(),\n  operatorNameOptions: ['min','max','avg', 'current', 'total', 'name'],\n  valueMaps: [\n    { value: 'null', op: '=', text: 'N/A' }\n  ],\n  mappingTypes: [\n    {name: 'value to text', value: 1},\n    {name: 'range to text', value: 2},\n  ],\n  rangeMaps: [\n    { from: 'null', to: 'null', text: 'N/A' }\n  ],\n  tickMaps: [],\n  mappingType: 1,\n  thresholds: '',\n  colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n  decimals: 2, // decimal precision\n  format: 'none', // unit format\n  operatorName: 'avg', // operator applied to time series\n  bullet: {\n    minValue: 0,\n    maxValue: 100,\n    tickSpaceMinVal: 1,\n    tickSpaceMajVal: 10,\n    bulletUnits: '', // no units by default, this will be selected by user\n    bulletRadius: 0, // 0 for auto-scale\n    pivotRadius: 0.1,\n    padding: 0.05,\n    edgeWidth: 0.05,\n    tickEdgeGap: 0.05,\n    tickLengthMaj: 0.15,\n    tickLengthMin: 0.05,\n    needleTickGap: 0.05,\n    needleLengthNeg: 0.2,\n    ticknessBulletBasis: 200,\n    needleWidth: 5,\n    tickWidthMaj: 5,\n    tickWidthMin: 1,\n    titleFontSize: 22,\n    subtitleFontSize: 18,\n    zeroTickAngle: 60,\n    maxTickAngle: 300,\n    zeroNeedleAngle: 40,\n    maxNeedleAngle: 320,\n    outerEdgeCol:  '#0099CC',\n    innerCol:      '#fff',\n    pivotCol:      '#999',\n    needleCol:     '#0099CC',\n    unitsLabelCol: '#000',\n    tickLabelCol:  '#000',\n    tickColMaj:    '#0099CC',\n    tickColMin:    '#000',\n    tickFont: 'Open Sans',\n    titleFont: 'Open Sans',\n    subtitleFont: 'Open Sans',\n    titleCol: '#fff',\n    subtitleCol: '#999',\n    rangeCol: '#0099CC',\n    measureCol:'#7eb26d',\n    markerCol: '#000',\n    tickCol: '#FFF',\n    rangesColor: [],\n    measuresColor : [],\n    valueYOffset: 0,\n    showThresholdOnBullet: false,\n    showThresholdColorOnValue: false,\n    showLowerThresholdRange: false,\n    showMiddleThresholdRange: true,\n    showUpperThresholdRange: true,\n    animateNeedleValueTransition: true,\n    animateNeedleValueTransitionSpeed: 100\n  },\n};\n\nclass D3BulletPanelCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, alertSrv) {\n    super($scope, $injector);\n    // merge existing settings with our defaults\n    _.defaults(this.panel, panelDefaults);\n    this.panel.bulletDivId = 'd3bullet_svg_' + this.panel.id;\n    this.containerDivId = 'container_'+this.panel.bulletDivId;\n    this.scoperef = $scope;\n    this.alertSrvRef = alertSrv;\n    this.initialized = false;\n    this.panelContainer = null;\n    this.panel.svgContainer = null;\n    this.svg = null;\n    this.panelWidth = null;\n    this.panelHeight = null;\n    this.bulletObject = null;\n    this.bulletsData =[\n      {\"title\":\"Revenue\",\"subtitle\":\"US$, in thousands\",\"ranges\":[150,225,300],\"measures\":[220,270],\"markers\":[250]},\n      {\"title\":\"Profit\",\"subtitle\":\"%\",\"ranges\":[20,25,30],\"measures\":[21,23],\"markers\":[26]},\n      {\"title\":\"Order Size\",\"subtitle\":\"US$, average\",\"ranges\":[350,500,600],\"measures\":[100,320],\"markers\":[550]},\n      {\"title\":\"New Customers\",\"subtitle\":\"count\",\"ranges\":[1400,2000,2500],\"measures\":[1000,1650],\"markers\":[2100]},\n      {\"title\":\"Satisfaction\",\"subtitle\":\"out of 5\",\"ranges\":[3.5,4.25,5],\"measures\":[3.2,4.7],\"markers\":[4.4]}\n    ];\n    this.data = {\n      value: 0,\n      valueFormatted: 0,\n      valueRounded: 0\n    };\n    this.series = [];\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    //this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n  }\n\n  onInitEditMode() {\n    // determine the path to this plugin\n    var panels = grafanaBootData.settings.panels;\n    var thisPanel = panels[this.pluginId];\n    var thisPanelPath = thisPanel.baseUrl + '/';\n    //add the relative path to the partial\n    var optionsPath = thisPanelPath + 'partials/editor.options.html';\n    this.addEditorTab('Options', optionsPath, 2);\n    // var radialMetricsPath = thisPanelPath + 'partials/editor.radialmetrics.html';\n    // this.addEditorTab('Radial Metrics', radialMetricsPath, 3);\n    // var thresholdingPath = thisPanelPath + 'partials/editor.thresholding.html';\n    // this.addEditorTab('Thresholding', thresholdingPath, 4);\n    // var mappingsPath = thisPanelPath + 'partials/editor.mappings.html';\n    // this.addEditorTab('Value Mappings', mappingsPath, 5);\n  }\n\n  /**\n   * [setContainer description]\n   * @param {[type]} container [description]\n   */\n  setContainer(container) {\n    this.panelContainer = container;\n    this.panel.svgContainer = container;\n  }\n\n  // determine the width of a panel by the span and viewport\n  getPanelWidthBySpan() {\n    var trueWidth = 0;\n    if (typeof this.panel.span === 'undefined') {\n      // get the width based on the scaled container (v5 needs this)\n      trueWidth = this.panelContainer.offsetParent.clientWidth;\n    } else {\n      // v4 and previous used fixed spans\n      var viewPortWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n      // get the pixels of a span\n      var pixelsPerSpan = viewPortWidth / 12;\n      // multiply num spans by pixelsPerSpan\n      trueWidth = Math.round(this.panel.span * pixelsPerSpan);\n    }\n    return trueWidth;\n  }\n\n  getPanelHeight() {\n    // panel can have a fixed height set via \"General\" tab in panel editor\n    var tmpPanelHeight = this.panel.height;\n    if ((typeof tmpPanelHeight === 'undefined') || (tmpPanelHeight === \"\")) {\n      // grafana also supplies the height, try to use that if the panel does not have a height\n      tmpPanelHeight = String(this.height);\n      // v4 and earlier define this height, detect span for pre-v5\n      if (typeof this.panel.span != 'undefined') {\n        // if there is no header, adjust height to use all space available\n        var panelTitleOffset = 20;\n        if (this.panel.title !== \"\") {\n          panelTitleOffset = 42;\n        }\n        tmpPanelHeight = String(this.containerHeight - panelTitleOffset); // offset for header\n      }\n      if (typeof tmpPanelHeight === 'undefined') {\n        // height still cannot be determined, get it from the row instead\n        tmpPanelHeight = this.row.height;\n        if (typeof tmpPanelHeight === 'undefined') {\n          // last resort - default to 250px (this should never happen)\n          tmpPanelHeight = \"250\";\n        }\n      }\n    }\n    // replace px\n    tmpPanelHeight = tmpPanelHeight.replace(\"px\",\"\");\n    // convert to numeric value\n    var actualHeight = parseInt(tmpPanelHeight);\n    return actualHeight;\n  }\n\n  clearSVG() {\n    if ($('#'+this.panel.bulletDivId).length) {\n      //console.log(\"Clearing SVG id: \" + this.panel.bulletDivId);\n      $('#'+this.panel.bulletDivId).remove();\n    }\n  }\n\n  renderBullet() {\n    // update the values to be sent to the bullet constructor\n    this.setValues(this.data);\n    if ($('#'+this.panel.bulletDivId).length) {\n      $('#'+this.panel.bulletDivId).remove();\n    }\n    $('.bullet').remove();\n    this.panelWidth = this.getPanelWidthBySpan();\n    this.panelHeight = this.getPanelHeight();\n    console.log(this.panelWidth);\n    console.log(this.panelHeight);\n    var data = this.bulletsData;\n    var margin = {top: 10, right: 40, bottom: 40, left: 120};\n    var width = this.panelWidth - margin.left - margin.right;\n    var height = this.panelHeight/data.length - margin.top - margin.bottom;\n    // set the width and height to be double the radius\n\n    if(this.panel.bullet.rangesColor.length === 0){\n      this.rangeColChange();\n    }\n    if(this.panel.bullet.measuresColor.length === 0){\n      this.measureColChange();\n    }\n    var chart = d3.bullet()\n      .width(width)\n      .height(height)\n      .options(this.panel.bullet);\n\n    this.svg = d3.select(\"#\" + this.containerDivId).selectAll(\"svg\")\n        .data(data)\n      .enter().append(\"svg\")\n        .attr(\"class\", \"bullet\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n      .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n        .call(chart);\n\n    var title = this.svg.append(\"g\")\n        .style(\"text-anchor\", \"end\")\n        .attr(\"transform\", \"translate(-6,\" + height / 2 + \")\");\n\n    title.append(\"text\")\n        .attr(\"class\", \"title\")\n        .attr(\"font-family\", this.panel.bullet.titleFont)\n        .attr(\"font-size\", this.panel.bullet.titleFontSize + \"px\")\n        .attr(\"fill\", this.panel.bullet.titleCol)\n        .text(function(d) { return d.title; });\n\n    title.append(\"text\")\n        .attr(\"class\", \"subtitle\")\n        .attr(\"font-family\", this.panel.bullet.subtitleFont)\n        .attr(\"font-size\", this.panel.bullet.subtitleFontSize + \"px\")\n        .attr(\"fill\", this.panel.bullet.subtitleCol)\n        .attr(\"dy\", \"1em\")\n        .text(function(d) { return d.subtitle; });\n\n    d3.selectAll(\"button\").on(\"click\", function() {\n      this.svg.datum(randomize).call(chart.duration(1000)); // TODO automatic transition\n    });\n  }\n  randomize(d) {\n    if (!d.randomizer) d.randomizer = randomizer(d);\n    d.ranges = d.ranges.map(d.randomizer);\n    d.markers = d.markers.map(d.randomizer);\n    d.measures = d.measures.map(d.randomizer);\n    return d;\n  }\n\n  randomizer(d) {\n    var k = d3.max(d.ranges) * 0.2;\n    return function(d) {\n      return Math.max(0, d + k * (Math.random() - 0.5));\n    };\n  }\n\n  getRandomColor(color) {\n    var p = 1,temp,random = Math.random(),result = '#';\n    while (p < color.length) {\n      temp = parseInt(color.slice(p, p += 2), 16);\n      temp += Math.floor((255 - temp) * random);\n      result += temp.toString(16).padStart(2, '0');\n    }\n    return result;\n  }\n\n  rangeColChange(){\n    var rangesColor = [];\n    var color = this.panel.bullet.rangeCol;\n    for (var i = 0; i < 30; i++) {\n      rangesColor.push(this.getRandomColor(color));\n    }\n    if(this.panel.bullet.rangesColor.length > 0){\n      this.panel.bullet.rangesColor = rangesColor;\n      this.render();\n    }\n    else{\n      this.panel.bullet.rangesColor = rangesColor;\n    }\n  }\n\n  measureColChange(){\n    var color = this.panel.bullet.measureCol;\n    var measuresColor = [];\n    for (var i = 0; i < 30; i++) {\n      measuresColor.push(this.getRandomColor(color));\n    }\n    if(this.panel.bullet.measuresColor.length > 0){\n      this.panel.bullet.measuresColor = measuresColor;\n      this.render();\n    }\n    else{\n      this.panel.bullet.measuresColor = measuresColor;\n    }\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  }\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  }\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\n  }\n\n  addTickMap() {\n    this.panel.tickMaps.push({value: 0, text: ''});\n  }\n  removeTickMap(tickMap) {\n    var index = _.indexOf(this.panel.tickMaps, tickMap);\n    this.panel.tickMaps.splice(index, 1);\n    this.render();\n  }\n\n  /**\n   * Ensure the min value is less than the max value, auto-adjust as needed\n   * @return void\n   */\n  validateLimitsMinValue() {\n    if (this.panel.bullet.minValue >= this.panel.bullet.maxValue) {\n      // set the maxValue to be the same as the minValue+1\n      this.panel.bullet.maxValue = this.panel.bullet.minValue + 1;\n      this.alertSrvRef.set(\"Problem!\", \"Minimum Value cannot be equal to or greater than Max Value, auto-adjusting Max Value to Minimum+1 (\" + this.panel.bullet.maxValue + \")\", 'warning', 10000);\n    }\n    this.render();\n  }\n\n  /**\n   * Ensure the max value is greater than the min value, auto-adjust as needed\n   * @return void\n   */\n  validateLimitsMaxValue() {\n    if (this.panel.bullet.maxValue <= this.panel.bullet.minValue) {\n      // set the minValue to be the same as the maxValue-1\n      this.panel.bullet.minValue = this.panel.bullet.maxValue - 1;\n      this.alertSrvRef.set(\"Problem!\", \"Maximum Value cannot be equal to or less than Min Value, auto-adjusting Min Value to Maximum-1 (\" + this.panel.bullet.minValue + \")\", 'warning', 10000);\n    }\n    this.render();\n  }\n\n  validateTransitionValue() {\n    if (this.panel.bullet.animateNeedleValueTransitionSpeed === null) {\n      this.panel.bullet.animateNeedleValueTransitionSpeed = 100;\n    }\n    if (this.panel.bullet.animateNeedleValueTransitionSpeed < 0) {\n      this.panel.bullet.animateNeedleValueTransitionSpeed = 0;\n    }\n    if (this.panel.bullet.animateNeedleValueTransitionSpeed > 60000) {\n      this.panel.bullet.animateNeedleValueTransitionSpeed = 60000;\n    }\n    this.render();\n  }\n\n  // sanity check for tick degree settings\n  validateBulletTickDegreeValues() {\n    if ((this.panel.bullet.zeroTickAngle === null) ||\n        (this.panel.bullet.zeroTickAngle === \"\") ||\n        (this.panel.bullet.zeroTickAngle < 0) ||\n        (isNaN(this.panel.bullet.zeroTickAngle))\n      ){\n      // alert about the error, and set it to 60\n      this.panel.bullet.zeroTickAngle = 60;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Zero Tick Angle, auto-setting to default of 60\", 'error', 10000);\n    }\n\n    if ((this.panel.bullet.maxTickAngle === null) ||\n        (this.panel.bullet.maxTickAngle === \"\") ||\n        (this.panel.bullet.maxTickAngle < 0) ||\n        (isNaN(this.panel.bullet.maxTickAngle))\n      ){\n      // alert about the error, and set it to 320\n      this.panel.bullet.maxTickAngle = 320;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Max Tick Angle, auto-setting to default of 320\", 'error', 10000);\n    }\n\n    var bulletTickDegrees = this.panel.bullet.maxTickAngle - this.panel.bullet.zeroTickAngle;\n    // make sure the total degrees does not exceed 360\n    if (bulletTickDegrees > 360) {\n      // set to default values and alert\n      this.panel.bullet.zeroTickAngle = 60;\n      this.panel.bullet.maxTickAngle = 320;\n      this.alertSrvRef.set(\"Problem!\", \"Bullet tick angle difference is larger than 360 degrees, auto-setting to default values\", 'error', 10000);\n    }\n    // make sure it is \"positive\"\n    if (bulletTickDegrees < 0) {\n      // set to default values and alert\n      this.panel.bullet.zeroTickAngle = 60;\n      this.panel.bullet.maxTickAngle = 320;\n      this.alertSrvRef.set(\"Problem!\", \"Bullet tick angle difference is less than 0 degrees, auto-setting to default values\", 'error', 10000);\n    }\n\n    // render\n    this.render();\n  }\n\n  // sanity check for Needle degree settings\n  validateBulletNeedleDegreeValues() {\n    if ((this.panel.bullet.zeroNeedleAngle === null) ||\n        (this.panel.bullet.zeroNeedleAngle === \"\") ||\n        (this.panel.bullet.zeroNeedleAngle < 0) ||\n        (isNaN(this.panel.bullet.zeroNeedleAngle))\n      ){\n      // alert about the error, and set it to 60\n      this.panel.bullet.zeroNeedleAngle = 60;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Zero Needle Angle, auto-setting to default of 60\", 'error', 10000);\n    }\n\n    if ((this.panel.bullet.maxNeedleAngle === null) ||\n        (this.panel.bullet.maxNeedleAngle === \"\") ||\n        (this.panel.bullet.maxNeedleAngle < 0) ||\n        (isNaN(this.panel.bullet.maxNeedleAngle))\n      ){\n      // alert about the error, and set it to 320\n      this.panel.bullet.maxNeedleAngle = 320;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Max Needle Angle, auto-setting to default of 320\", 'error', 10000);\n    }\n\n    var bulletNeedleDegrees = this.panel.bullet.maxNeedleAngle - this.panel.bullet.zeroNeedleAngle;\n    // make sure the total degrees does not exceed 360\n    if (bulletNeedleDegrees > 360) {\n      // set to default values and alert\n      this.panel.bullet.zeroNeedleAngle = 60;\n      this.panel.bullet.maxNeedleAngle = 320;\n      this.alertSrvRef.set(\"Problem!\", \"Bullet needle angle difference is larger than 360 degrees, auto-setting to default values\", 'error', 10000);\n    }\n    // make sure it is \"positive\"\n    if (bulletNeedleDegrees < 0) {\n      // set to default values and alert\n      this.panel.bullet.zeroNeedleAngle = 60;\n      this.panel.bullet.maxNeedleAngle = 320;\n      this.alertSrvRef.set(\"Problem!\", \"Bullet needle angle difference is less than 0 degrees, auto-setting to default values\", 'error', 10000);\n    }\n\n    // render\n    this.render();\n  }\n\n  validateRadialMetricValues() {\n    // make sure the spacing values are valid\n    if ((this.panel.bullet.tickSpaceMinVal === null) ||\n        (this.panel.bullet.tickSpaceMinVal === \"\") ||\n        (isNaN(this.panel.bullet.tickSpaceMinVal))\n      ){\n      // alert about the error, and set it to 1\n      this.panel.bullet.tickSpaceMinVal = 1;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Tick Spacing Minor, auto-setting back to default of 1\", 'error', 10000);\n    }\n    if ((this.panel.bullet.tickSpaceMajVal === null) ||\n        (this.panel.bullet.tickSpaceMajVal === \"\") ||\n        (isNaN(this.panel.bullet.tickSpaceMajVal))\n      ){\n      // alert about the error, and set it to 10\n      this.panel.bullet.tickSpaceMajVal = 10;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Tick Spacing Major, auto-setting back to default of 10\", 'error', 10000);\n    }\n    if ((this.panel.bullet.bulletRadius === null) ||\n        (this.panel.bullet.bulletRadius === \"\") ||\n        (isNaN(this.panel.bullet.bulletRadius) ||\n        (this.panel.bullet.bulletRadius < 0))\n      ){\n      // alert about the error, and set it to 0\n      this.panel.bullet.bulletRadius = 0;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Bullet Radius, auto-setting back to default of 0\", 'error', 10000);\n    }\n    this.render();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    //console.log(\"d3bullet inside link\");\n    var bulletByClass = elem.find('.grafana-d3-bullet');\n    //bulletByClass.append('<center><div id=\"'+ctrl.containerDivId+'\"></div></center>');\n    bulletByClass.append('<div id=\"'+ctrl.containerDivId+'\"></div>');\n    var container = bulletByClass[0].childNodes[0];\n    ctrl.setContainer(container);\n    function render() {\n      ctrl.renderBullet();\n    }\n    this.events.on('render', function() {\n      render();\n      ctrl.renderingCompleted();\n    });\n  }\n\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return {decimals: this.panel.decimals, scaledDecimals: null};\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n        norm = delta / magn, // norm is between 1.0 and 10.0\n        size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) { dec = 0; }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n    return result;\n  }\n\n  setValues(data) {\n    var columns = [];\n    var bulletsData = [];\n    if(!this.series.columns)\n      return;\n    if(this.series.columns.length > 0){\n      for(var i = 0; i < this.series.columns.length; i++){\n        columns.push(this.series.columns[i].text);\n      }\n      for(i = 0; i < this.series.rows.length; i++){\n        bulletsData.push({});\n        for(var j = 0; j < columns.length; j++){\n          if(columns[j] == \"ranges\" || columns[j] == \"measures\" || columns[j] == \"markers\")\n            bulletsData[i][columns[j]] = JSON.parse(this.series.rows[i][j]);\n          else\n            bulletsData[i][columns[j]] = this.series.rows[i][j];\n        }\n      }\n      data.bullets = bulletsData;\n    }\n  }\n\n  getValueText() {\n    return this.data.valueFormatted;\n  }\n\n  getValueRounded() {\n    return this.data.valueRounded;\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.render();\n  }\n\n  onDataError(err) {\n    this.onDataReceived([]);\n  }\n  parseSeries(series) {\n    return _.map(this.series, (serie, i) => {\n      return {\n        title: serie.alias,\n        subtitle:serie.alias,\n        ranges: [parseInt(serie.stats.min.toFixed(2)), parseInt(serie.stats.max.toFixed(2))- parseInt(serie.stats.range.toFixed(2))/2 ,parseInt(serie.stats.max.toFixed(2))],\n        measures:[parseInt(serie.stats.min.toFixed(2)) + parseInt(serie.stats.range.toFixed(2))/3, parseInt(serie.stats.min.toFixed(2)) + parseInt(serie.stats.range.toFixed(2))/3*2],\n        markers:[parseInt(serie.stats.avg.toFixed(2))]\n      };\n    });\n  }\n  onDataReceived(dataList) {\n    this.series = dataList.map(this.seriesHandler.bind(this));\n    var data = {};\n    this.bulletsData = this.parseSeries(this.series);\n    if(this.bulletObject !== null){\n      this.bulletObject.updateBullet(data.value, data.valueFormatted, data.valueRounded);\n    } else {\n      // render bullet\n      this.render();\n    }\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  invertColorOrder() {\n    var tmp = this.panel.colors[0];\n    this.panel.colors[0] = this.panel.colors[2];\n    this.panel.colors[2] = tmp;\n    this.render();\n  }\n}\n\nfunction getColorForValue(data, value) {\n  for (var i = data.thresholds.length; i > 0; i--) {\n    if (value >= data.thresholds[i-1]) {\n      return data.colorMap[i];\n    }\n  }\n  return _.first(data.colorMap);\n}\n\nD3BulletPanelCtrl.templateUrl = 'partials/template.html';\nexport {\n  D3BulletPanelCtrl,\n  D3BulletPanelCtrl as MetricsPanelCtrl\n};\n"]}